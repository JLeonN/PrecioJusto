# PLAN DE TRABAJO - ACTUALIZACIÃ“N DE PRECIOS VIGENTES
Proyecto: Precio Justo
Fecha inicio: 12 de Febrero 2026
Responsable: Leo + CH

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“– DESCRIPCIÃ“N DEL PLAN

Este plan detalla la correcciÃ³n crÃ­tica del sistema de precios en la aplicaciÃ³n
Precio Justo. El problema actual es que la app muestra el precio MÃS BAJO 
HISTÃ“RICO en lugar del precio MÃS RECIENTE/VIGENTE, lo que genera informaciÃ³n
incorrecta y confusa para los usuarios.

### PROBLEMA ACTUAL:
- Sistema muestra siempre el precio mÃ¡s bajo de toda la historia
- Ignora la fecha del precio (no considera si es actual o antiguo)
- Ejemplo: Si un producto costaba $600 hace 3 meses y ahora cuesta $610,
  la app sigue mostrando $600 como "mejor precio" (dato obsoleto)
- TOP 3 puede mostrar el mismo comercio 2-3 veces con precios histÃ³ricos
  diferentes, lo que confunde al usuario

### OBJETIVOS PRINCIPALES:
- Mostrar precios VIGENTES (mÃ¡s recientes) en lugar de histÃ³ricos
- Agrupar precios por comercio â†’ tomar el mÃ¡s reciente de cada uno
- TOP 3 debe mostrar mÃ¡ximo 3 COMERCIOS DISTINTOS (no duplicados)
- Agregar indicador de frescura (>60 dÃ­as = badge de advertencia)
- Crear modal rÃ¡pido para agregar precios sin formulario completo
- Pre-seleccionar Ãºltimo comercio usado para cada producto especÃ­fico

### CARACTERÃSTICAS CLAVE:
- LÃ³gica de precio vigente por comercio (no histÃ³rico global)
- Badge visual de "Desactualizado" para precios >60 dÃ­as
- Modal "Agregar Precio" con:
  - TÃ­tulo con nombre del producto
  - Input pre-seleccionado con precio actual
  - Selector inteligente de comercios (Ãºltimo usado)
  - IntegraciÃ³n con DialogoAgregarComercioRapido
- TOP 3 con comercios Ãºnicos (filtrar duplicados por nombreCompleto)
- Cambio de texto UI: "Top 3 mejores precios" â†’ "Top 3 precios actuales"

### TECNOLOGÃAS:
- Vue.js 3 + Composition API
- Quasar Framework (q-dialog, q-input, q-select)
- Pinia (productosStore, comerciosStore)
- Capacitor Storage
- Tabler Icons

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âœ… FASE 1: ARREGLAR LÃ“GICA PRECIO VIGENTE ğŸ”§ [COMPLETADA]

### Modificar ProductosService.js
[x] Abrir archivo src/almacenamiento/servicios/ProductosService.js
[x] Modificar mÃ©todo _calcularCamposAutomaticos()
[x] Implementar agrupaciÃ³n por comercio (nombreCompleto)
[x] Ordenar precios por fecha DESC dentro de cada grupo
[x] Tomar el precio MÃS RECIENTE de cada comercio
[x] De los precios vigentes, encontrar el mÃ¡s bajo
[x] Actualizar precioMejor con precio vigente (no histÃ³rico)
[x] Actualizar comercioMejor con comercio del precio vigente
[x] Marcar precio.esMejor correctamente
[x] Calcular diferenciaPrecio entre mejor y peor vigente
[x] Conservar mÃ©todo _calcularTendencia() existente
[x] Conservar mÃ©todo _calcularPorcentajeTendencia() existente

### Validaciones
[x] Verificar que productos sin precios no rompen
[x] Verificar que productos con 1 solo precio funcionan
[x] Verificar que productos con mÃºltiples comercios funcionan
[x] Verificar compatibilidad con datos legacy (sin nombreCompleto)

### Testing
[x] Cargar productos existentes y verificar recÃ¡lculo
[x] Verificar que precioMejor cambia correctamente
[x] Verificar que comercioMejor cambia correctamente
[x] Verificar que tarjetas muestran precio vigente
[x] Verificar que detalle de producto sigue funcionando

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## â¸ï¸ FASE 2: TOP 3 ÃšNICO + BADGE FRESCURA ğŸ¨ [PENDIENTE]

### Modificar TarjetaProducto.vue
[ ] Abrir archivo src/components/Tarjetas/TarjetaProducto.vue
[ ] Cambiar tÃ­tulo: "Top 3 mejores precios" â†’ "Top 3 precios actuales"
[ ] Modificar computed top3Precios
[ ] Agrupar precios por nombreCompleto
[ ] Tomar precio mÃ¡s reciente de cada comercio
[ ] Ordenar por valor ASC
[ ] Tomar primeros 3 comercios distintos
[ ] MÃ¡ximo 3 resultados (no repetir comercios)

### Agregar badge de frescura
[ ] Crear computed calcularDiasPrecio(fechaISO)
[ ] Calcular dÃ­as transcurridos desde fecha
[ ] Si >60 dÃ­as: mostrar badge "âš ï¸ Hace X meses"
[ ] Color: --color-acento (naranja #FF9800)
[ ] PosiciÃ³n: debajo de nombre del comercio
[ ] Solo visible en precios >60 dÃ­as

### Estilos del badge
[ ] Crear clase .badge-desactualizado
[ ] Font-size: 10px
[ ] Padding: 2px 6px
[ ] Border-radius: 4px
[ ] Background: var(--color-acento) con opacity 0.2
[ ] Color texto: var(--color-acento)
[ ] Display: inline-flex con Ã­cono

### Testing
[ ] Verificar TOP 3 no muestra comercios duplicados
[ ] Verificar badge aparece en precios >60 dÃ­as
[ ] Verificar badge NO aparece en precios recientes
[ ] Verificar texto "Top 3 precios actuales" visible
[ ] Verificar responsividad en mÃ³vil/tablet/PC

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## â¸ï¸ FASE 3: MODAL AGREGAR PRECIO ğŸš€ [PENDIENTE]

### Crear DialogoAgregarPrecio.vue
[ ] Crear archivo src/components/Formularios/Dialogos/DialogoAgregarPrecio.vue
[ ] Estructura bÃ¡sica q-dialog con persistent y maximized
[ ] Importar useQuasar, useProductosStore, useComerciStore
[ ] Props: modelValue (Boolean), productoId (String, required)
[ ] Emits: 'update:modelValue', 'precio-guardado'

### Header del modal
[ ] q-card-section con clase "row items-center"
[ ] TÃ­tulo dinÃ¡mico: producto.nombre
[ ] SubtÃ­tulo: "Precio actual: $XXX"
[ ] BotÃ³n cerrar (q-btn flat round dense icon="close")

### Formulario principal
[ ] Input precio (q-input type="number")
[ ] Valor por defecto: producto.precioMejor
[ ] Input pre-seleccionado (select all on focus)
[ ] ValidaciÃ³n: requerido, nÃºmero positivo
[ ] Placeholder: "IngresÃ¡ el nuevo precio"

### Selector de comercios
[ ] q-select con use-input para bÃºsqueda
[ ] Opciones: comerciosStore.comerciosPorUso
[ ] Formato opciÃ³n: "Nombre Comercio - DirecciÃ³n"
[ ] Pre-selecciÃ³n inteligente: Ãºltimo comercio usado en este producto
[ ] Filtrado en tiempo real con @filter
[ ] Buscador tipo Google (centrado, auto-focus)

### Selector de direcciones
[ ] q-select dependiente del comercio seleccionado
[ ] Cargar direcciones del comercio elegido
[ ] Auto-seleccionar direcciÃ³n mÃ¡s usada
[ ] Actualizar cuando cambia comercio
[ ] Deshabilitado si no hay comercio seleccionado

### SecciÃ³n expandible "Agregar comercio nuevo"
[ ] BotÃ³n expandir: "ğŸ”½ Agregar nuevo comercio"
[ ] q-expansion-item para mostrar/ocultar
[ ] Al expandir: abrir DialogoAgregarComercioRapido
[ ] Pasar datos pre-llenados si usuario escribiÃ³ algo
[ ] Al guardar comercio: auto-seleccionar en selector
[ ] Al guardar comercio: colapsar expansiÃ³n
[ ] Flujo: crear â†’ seleccionar â†’ listo para guardar precio

### Botones de acciÃ³n
[ ] q-card-actions align="right"
[ ] BotÃ³n "Cancelar" (q-btn flat)
[ ] BotÃ³n "Guardar precio" (q-btn color="primary" :loading="guardando")
[ ] Validar formulario antes de guardar
[ ] Deshabilitar guardar si faltan datos

### LÃ³gica de guardado
[ ] Construir objeto precio con todos los campos
[ ] Incluir: comercioId, direccionId, nombreCompleto
[ ] Llamar productosStore.agregarPrecio(productoId, precio)
[ ] Llamar comerciosStore.registrarUso(comercioId, direccionId)
[ ] NotificaciÃ³n success con Quasar Notify
[ ] Emit 'precio-guardado' con producto actualizado
[ ] Cerrar modal automÃ¡ticamente

### IntegraciÃ³n con DialogoAgregarComercioRapido
[ ] Importar DialogoAgregarComercioRapido.vue
[ ] Estado: dialogoComercioRapidoAbierto (ref)
[ ] Pre-llenar nombre si usuario escribiÃ³ en selector
[ ] Escuchar evento @comercio-guardado
[ ] Actualizar selector con nuevo comercio
[ ] Auto-seleccionar nuevo comercio
[ ] Cerrar diÃ¡logo de comercio rÃ¡pido

### Testing del modal
[ ] Abrir modal desde botÃ³n "+ Agregar precio"
[ ] Verificar tÃ­tulo muestra nombre producto correcto
[ ] Verificar precio actual visible
[ ] Verificar input precio pre-seleccionado
[ ] Verificar Ãºltimo comercio pre-seleccionado
[ ] Verificar creaciÃ³n de comercio nuevo funciona
[ ] Verificar guardado de precio funciona
[ ] Verificar notificaciÃ³n aparece
[ ] Verificar modal cierra correctamente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## â¸ï¸ FASE 4: INTEGRACIÃ“N CON TARJETAS ğŸ”— [PENDIENTE]

### Modificar TarjetaProducto.vue
[ ] Agregar evento @click en botÃ³n "Agregar precio"
[ ] Emit 'agregar-precio' con producto.id
[ ] Verificar stop propagation funciona

### Modificar MisProductosPage.vue
[ ] Importar DialogoAgregarPrecio.vue
[ ] Estado: dialogoPrecioAbierto (ref false)
[ ] Estado: productoSeleccionadoId (ref null)
[ ] MÃ©todo manejarAgregarPrecio(productoId)
[ ] Abrir DialogoAgregarPrecio con productoId
[ ] Escuchar evento @precio-guardado
[ ] Recargar productos despuÃ©s de guardar
[ ] Mostrar notificaciÃ³n de Ã©xito

### Testing de integraciÃ³n
[ ] Click en botÃ³n "+ Agregar precio" en tarjeta
[ ] Verificar modal abre con datos correctos
[ ] Guardar precio y verificar tarjeta actualiza
[ ] Verificar precio vigente se recalcula
[ ] Verificar TOP 3 actualiza correctamente
[ ] Verificar badge de frescura funciona

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## â¸ï¸ FASE 5: TESTING Y AJUSTES ğŸ§ª [PENDIENTE]

### Testing funcional completo
[ ] Crear producto nuevo con 1 precio
[ ] Agregar segundo precio mismo comercio (mÃ¡s caro)
[ ] Verificar que muestra el mÃ¡s reciente (no el mÃ¡s barato)
[ ] Agregar tercer precio distinto comercio
[ ] Verificar TOP 3 muestra comercios Ãºnicos
[ ] Agregar precio >60 dÃ­as en el pasado (manual)
[ ] Verificar badge "Desactualizado" aparece
[ ] Verificar pre-selecciÃ³n de Ãºltimo comercio usado

### Testing de escenarios edge case
[ ] Producto con 1 solo precio (no rompe)
[ ] Producto con 5+ precios mismo comercio (toma mÃ¡s reciente)
[ ] Producto con 10+ comercios (TOP 3 solo 3 distintos)
[ ] Comercio con mÃºltiples direcciones (cuenta como distintos)
[ ] Precio sin nombreCompleto (compatibilidad legacy)
[ ] Cambio rÃ¡pido de comercio en modal

### Testing responsivo
[ ] MÃ³vil (xs) - 360px
[ ] Tablet (sm) - 768px
[ ] Desktop (md) - 1024px
[ ] Desktop XL (xl) - 1920px
[ ] Badge frescura en todos los breakpoints
[ ] Modal en mÃ³vil (fullscreen)
[ ] Modal en desktop (centrado)

### Testing de UX
[ ] Input precio se selecciona al hacer focus
[ ] Buscador de comercios funciona fluido
[ ] Crear comercio nuevo no rompe flujo
[ ] Notificaciones aparecen correctamente
[ ] Feedback visual al guardar (loading)
[ ] Animaciones suaves y sin lag

### Optimizaciones
[ ] Verificar performance con 100+ productos
[ ] Verificar re-renders innecesarios
[ ] Optimizar computed properties
[ ] Verificar memoria (no memory leaks)
[ ] Lazy loading si es necesario

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## â¸ï¸ FASE 6: DOCUMENTACIÃ“N ğŸ“š [PENDIENTE]

### Actualizar archivos de documentaciÃ³n
[ ] Actualizar Resumen1General.txt
  [ ] Agregar feature "Sistema de precios vigentes"
  [ ] Agregar feature "Modal agregar precio rÃ¡pido"
  [ ] Agregar feature "Badge de frescura de precios"
  [ ] Actualizar descripciÃ³n de TOP 3

[ ] Actualizar Resumen2Tarjetas.txt
  [ ] Documentar cambio de tÃ­tulo TOP 3
  [ ] Documentar badge de frescura
  [ ] Documentar lÃ³gica de comercios Ãºnicos
  [ ] Documentar evento 'agregar-precio'

[ ] Actualizar Resumen4FormularioAgregar.txt
  [ ] Documentar DialogoAgregarPrecio.vue
  [ ] Documentar flujo de agregar precio rÃ¡pido
  [ ] Documentar pre-selecciÃ³n inteligente
  [ ] Documentar integraciÃ³n con comercio rÃ¡pido

[ ] Actualizar Resumen7LocalStorage.txt
  [ ] Documentar cambio en _calcularCamposAutomaticos()
  [ ] Documentar nuevo mÃ©todo de agrupaciÃ³n por comercio
  [ ] Documentar lÃ³gica de precio vigente vs histÃ³rico

[ ] Actualizar PlanTrabajoActualizacionPrecios.txt
  [ ] Marcar fases completadas
  [ ] Agregar notas de implementaciÃ³n
  [ ] Documentar decisiones tÃ©cnicas
  [ ] Actualizar progreso general

### Comentarios en cÃ³digo
[ ] Documentar funciÃ³n agruparPorComercio()
[ ] Documentar funciÃ³n obtenerPrecioMasReciente()
[ ] Documentar computed top3PreciosUnicos
[ ] Documentar computed calcularDiasPrecio()
[ ] Agregar JSDoc en mÃ©todos principales
[ ] Comentar algoritmos complejos

### README y guÃ­as
[ ] Crear guÃ­a de uso: "CÃ³mo agregar precios rÃ¡pidamente"
[ ] Crear guÃ­a tÃ©cnica: "Sistema de precios vigentes"
[ ] Documentar diferencia entre precio histÃ³rico y vigente
[ ] Crear diagrama de flujo de agregar precio

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## NOTAS IMPORTANTES ğŸ“Œ

### Compatibilidad con datos existentes
- Sistema debe funcionar con productos que ya tienen precios guardados
- Recalcular automÃ¡ticamente al actualizar ProductosService.js
- No requiere migraciÃ³n de datos
- Mantener compatibilidad con precios sin nombreCompleto

### Cambios en UI/UX
- "Top 3 mejores precios" â†’ "Top 3 precios actuales"
- Badge "Desactualizado" solo si >60 dÃ­as
- Pre-selecciÃ³n inteligente de comercios
- Input precio pre-seleccionado (mejor UX)

### IntegraciÃ³n con sistemas existentes
- Reutilizar DialogoAgregarComercioRapido
- Reutilizar selectores de comercios/direcciones
- Reutilizar sistema de notificaciones Quasar
- Reutilizar comerciosStore.registrarUso()

### Flujo de trabajo
- Fase 1 es CRÃTICA (arregla lÃ³gica de base)
- Fase 2 mejora visualizaciÃ³n (TOP 3 + badge)
- Fase 3 mejora UX (modal rÃ¡pido)
- Fase 4 integra todo el sistema
- Fase 5 asegura calidad
- Fase 6 documenta todo

### Testing
- Probar cada fase antes de seguir a la siguiente
- Guardar progreso con commits frecuentes
- Verificar en mÃ³vil real (no solo emulador)
- Validar con datos de prueba y datos reales

### Prioridades
1. âœ… Arreglar lÃ³gica precio vigente (funcionalidad)
2. âœ… Arreglar TOP 3 comercios Ãºnicos (claridad)
3. âœ… Modal agregar precio (UX)
4. Testing completo (calidad)
5. DocumentaciÃ³n (mantenibilidad)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## DECISIONES TÃ‰CNICAS ğŸ¤”

### Â¿Por quÃ© precio vigente y no histÃ³rico?
- Usuario necesita informaciÃ³n ACTUAL para tomar decisiones
- Mostrar $600 histÃ³rico cuando ahora cuesta $610 es engaÃ±oso
- Historial completo sigue disponible en detalle de producto
- Precio vigente = precio mÃ¡s reciente de cada comercio

### Â¿Por quÃ© 60 dÃ­as para badge de frescura?
- Compromiso entre actualidad y utilidad
- 30 dÃ­as serÃ­a muy estricto
- 90 dÃ­as serÃ­a muy permisivo
- 60 dÃ­as da margen razonable para precios estables

### Â¿Por quÃ© pre-seleccionar Ãºltimo comercio usado?
- Usuario suele comprar en los mismos lugares
- Ahorra tiempo y clicks
- Mejora UX significativamente
- ReducciÃ³n de fricciÃ³n en el flujo

### Â¿Por quÃ© modal rÃ¡pido y no formulario completo?
- Agregar precio es acciÃ³n frecuente
- Formulario completo es pesado
- Modal enfoca solo lo esencial
- IntegraciÃ³n con comercio rÃ¡pido mantiene flexibilidad

### Â¿Por quÃ© TOP 3 con comercios Ãºnicos?
- Confunde ver mismo comercio 2-3 veces
- Usuario busca comparar entre LUGARES diferentes
- Si quiere ver historial de un comercio â†’ detalle producto
- TOP 3 debe ser panorama rÃ¡pido de opciones

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## MEJORAS FUTURAS (POST-MVP) ğŸš€

[ ] NotificaciÃ³n si precio subiÃ³/bajÃ³ significativamente
[ ] Sugerencia automÃ¡tica de comercio mÃ¡s cercano (geolocalizaciÃ³n)
[ ] Compartir precios con otros usuarios
[ ] GrÃ¡fico de evoluciÃ³n de precios por comercio
[ ] PredicciÃ³n de tendencia de precios (ML)
[ ] Alertas de precios (notificar si baja de X monto)
[ ] Comparador de productos similares
[ ] Lista de compras inteligente (suma precios)
[ ] Exportar reporte de precios a PDF
[ ] Widget de precio en home screen
[ ] IntegraciÃ³n con programas de fidelidad
[ ] Sistema de cupones y descuentos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“Š PROGRESO GENERAL: 0% COMPLETADO

â¸ï¸ Fase 1: 0% (Arreglar lÃ³gica precio vigente)
â¸ï¸ Fase 2: 0% (TOP 3 Ãºnico + badge frescura)
â¸ï¸ Fase 3: 0% (Modal agregar precio)
â¸ï¸ Fase 4: 0% (IntegraciÃ³n con tarjetas)
â¸ï¸ Fase 5: 0% (Testing y ajustes)
â¸ï¸ Fase 6: 0% (DocumentaciÃ³n)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**ÃšLTIMA ACTUALIZACIÃ“N:** 12 de Febrero 2026 - Plan creado
**PRÃ“XIMO PASO:** Fase 1 - Arreglar lÃ³gica de precio vigente en ProductosService.js
**ESTADO:** Listo para comenzar implementaciÃ³n
