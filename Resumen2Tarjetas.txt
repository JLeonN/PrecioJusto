# TARJETAS DE PRODUCTOS - DOCUMENTACIÓN TÉCNICA

## COMPONENTES RELACIONADOS
- TarjetaProducto.vue (componente reutilizable en /components/Tarjetas/)
- ListaProductos.vue (contenedor en /components/MisProductos/)
- BarraSeleccion.vue (barra sticky para modo selección en /components/Compartidos/)
- BarraAccionesSeleccion.vue (barra fixed bottom en /components/Compartidos/)

## MODO SELECCIÓN

### ACTIVACIÓN
- Long-press de 1 segundo en cualquier tarjeta
- Vibración háptica en móvil al activar
- Primera tarjeta presionada queda seleccionada automáticamente

### COMPORTAMIENTO VISUAL
- Checkbox circular en esquina superior derecha
- Overlay verde semi-transparente (--color-secundario-claro)
- Borde verde (--color-secundario) cuando está seleccionada
- Animación fade-in del checkbox (0.3s)

### COMPORTAMIENTO DE CLICK
- Modo selección activo: tap simple marca/desmarca
- Modo normal: tap simple expande/colapsa
- Botón "Agregar precio" oculto en modo selección
- Sección expandida oculta en modo selección
- Ícono chevron oculto en modo selección

### PROPS
- modoSeleccion (Boolean): Indica si está en modo selección
- seleccionado (Boolean): Indica si esta tarjeta está seleccionada
- producto (Object, required): Datos del producto a mostrar

### EVENTOS
- 'long-press': Emitido al hacer long-press (1 seg)
- 'toggle-seleccion': Emitido al hacer tap en modo selección
- 'agregar-precio': Emitido al clickear botón agregar precio
- 'ver-detalle': Emitido al clickear "Ver historial completo"

### BARRAS DE INTERFAZ
- BarraSeleccion: Sticky debajo del header, muestra contador y botón "Seleccionar todo"
- BarraAccionesSeleccion: Fixed bottom con botones "Eliminar" y "Cancelar"

### COMPOSABLE REUTILIZABLE
- useSeleccionMultiple.js: Lógica completa de selección múltiple
- Reutilizable en cualquier página con listas
- Maneja estado, métodos de selección, y eventos

## ESTRUCTURA DE DATOS DEL PRODUCTO
Cada producto requiere:
- id (string): Identificador único alfanumérico
- nombre (string): Nombre del producto
- imagen (string | null): URL de la imagen o null
- codigoBarras (string | null): Código de barras EAN/UPC
- precioMejor (number): Precio más bajo actual
- comercioMejor (string): Nombre del comercio con mejor precio
- diferenciaPrecio (number): Diferencia entre precio más bajo y más alto
- precios (array de objetos):
  - id (string): ID único del precio
  - comercio (string): Nombre del comercio
  - valor (number): Precio numérico
  - fecha (string): Fecha en formato ISO 8601
  - esMejor (boolean): Indica si es el precio más bajo
  - confirmaciones (number): Cantidad de confirmaciones comunitarias

## CÓDIGO DE BARRAS COPIABLE
- Muestra debajo del nombre con ícono IconBarcode (14px)
- Click para copiar al portapapeles con notificación Quasar
- Tooltip "Click para copiar" al hacer hover
- Feedback visual con background hover/active
- Fuente monoespaciada (Courier New, 11px)
- Solo visible si producto tiene codigoBarras
- Usa stop propagation para no expandir tarjeta al copiar

## COMPORTAMIENTO VISUAL

### ESTADO COLAPSADO (default)
- Muestra: imagen/placeholder, nombre, código de barras (si existe), mejor precio, comercio del mejor precio
- Botón "Agregar precio" en modo redondo (solo ícono)
- Ícono chevron-down indicando expandible
- Click en tarjeta expande/colapsa (solo en modo normal)

### ESTADO EXPANDIDO
- Muestra top 3 mejores precios ordenados por valor
- Botón "Agregar precio" expandido con texto visible
- Lista con avatares numerados (1,2,3)
- Avatar verde (#4CAF50) para el mejor precio
- Avatar gris (#9E9E9E) para precios 2 y 3
- Fechas formateadas en modo relativo (hace X días/horas/semanas/meses)
- Botón "Ver historial completo" al final con ícono IconChartLine
- Ícono chevron-up indicando colapsable
- Transición suave con q-slide-transition

## DISEÑO RESPONSIVO

### MÓVIL (xs - menor a 600px)
- Layout vertical (flex-direction: column)
- Imagen: 140px x 140px centrada
- Info apilada verticalmente
- Espaciado: gap de 12px
- Padding: 16px

### TABLET/PC (sm y mayor - 600px+)
- Layout horizontal (grid 3 columnas: 80px | 1fr | auto)
- Imagen: 80px x 80px
- Info y controles en línea horizontal
- Espaciado: gap de 16px
- Mejor aprovechamiento del espacio

## INTERACCIONES

### Gestos Touch
- Click simple (modo normal): toggleExpandir()
- Click simple (modo selección): emit('toggle-seleccion')
- Long-press 1 segundo: emit('long-press') + vibración háptica
- v-touch-hold:1000.mouse: Directiva Quasar para detectar long-press

### Clicks con Stop Propagation
- Click en botón agregar: emit('agregar-precio') + stop propagation
- Click en código de barras: copiar al portapapeles + stop propagation
- Click en "Ver historial": emit('ver-detalle') + stop propagation

### Feedback Visual
- Animación de presión (scale 0.98) en :active
- Transform translateY(-2px) en :hover (solo PC)
- Box-shadow aumenta en hover
- Transiciones suaves de 0.3s

## ESTILOS CLAVE

### Estados de la Tarjeta
- Normal: borde izquierdo azul (4px) como marca visual
- Seleccionada: borde verde (4px) + box-shadow verde
- Hover: elevación con translateY(-2px) y sombra mayor
- Active: scale(0.98) para feedback táctil

### Overlay de Selección
- Position: absolute cubriendo toda la tarjeta
- Background: --color-secundario-claro
- Opacity: 0.15
- Z-index: 1
- Pointer-events: none

### Transiciones
- Tarjeta general: all 0.3s ease
- Checkbox fade: opacity 0.3s ease
- Botón agregar: width 0.2s, opacity 0.3s
- Texto expandido: opacity 0.3s

### Tipografía
- Nombre producto: text-subtitle1, font-weight-bold
- Precio: text-h5, font-weight-bold, text-primary
- Comercio: text-caption, text-grey-7
- Código barras: 11px, Courier New (monospace)

### Ellipsis y Truncamiento
- Nombre: ellipsis 2 líneas (-webkit-line-clamp: 2)
- Comercio: ellipsis 1 línea (white-space: nowrap)
- Min-height en nombre: 3em para consistencia

## ICONOGRAFÍA (Tabler Icons)
- IconShoppingBag: placeholder imagen (32px, grey-5)
- IconMapPin: ubicación comercio (16px)
- IconPlus: agregar precio (18px)
- IconChevronDown/Up: expandir/colapsar (20px)
- IconChartLine: ver historial (18px)
- IconBarcode: código de barras (14px)

## COMPUTED PROPERTIES
- top3Precios: Ordena precios por valor ASC y toma primeros 3
```javascript
  const top3Precios = computed(() => {
    return [...props.producto.precios]
      .sort((a, b) => a.valor - b.valor)
      .slice(0, 3)
  })
```
- clasesResponsivas: Determina layout según $q.screen
```javascript
  const clasesResponsivas = computed(() => {
    return $q.screen.xs ? 'tarjeta-vertical' : 'tarjeta-horizontal'
  })
```

## FUNCIONES

### formatearFecha(fechaISO)
Convierte fechas ISO 8601 a formato relativo legible
- Menos de 60 minutos: "Hace X minutos"
- Menos de 24 horas: "Hace X horas"
- Menos de 7 días: "Hace X días"
- Menos de 4 semanas: "Hace X semanas"
- Más de 4 semanas: "Hace X meses"
- Retorno especial: "Hace un momento" si < 1 minuto

### copiarCodigoBarras(codigo)
Copia código al portapapeles usando Navigator Clipboard API
- Try/catch para manejo de errores
- Notificación Quasar tipo 'positive' al copiar
- Notificación tipo 'negative' si falla
- Muestra el código copiado en caption
- Timeout: 1500ms
- Position: top

### toggleExpandir()
Alterna el estado expandido de la tarjeta
```javascript
const toggleExpandir = () => {
  expandida.value = !expandida.value
}
```

### manejarClick()
Lógica condicional según modo actual
```javascript
const manejarClick = () => {
  if (props.modoSeleccion) {
    emit('toggle-seleccion', props.producto.id)
  } else {
    toggleExpandir()
  }
}
```

### manejarLongPress()
Activa modo selección con vibración
```javascript
const manejarLongPress = () => {
  if (!props.modoSeleccion) {
    if ($q.platform.is.mobile && navigator.vibrate) {
      navigator.vibrate(50)
    }
    emit('long-press', props.producto.id)
  }
}
```

## LIMITACIONES ACTUALES
- Solo muestra top 3 en expansión (no scroll infinito)
- No hay funcionalidad de menú contextual aún
- No hay edición inline de productos
- No hay drag & drop para reordenar

## INTEGRACIÓN CON STORES

### DATOS
- ListaProductos recibe productos desde productosStore
- Datos reactivos: cambios en store actualizan UI automáticamente
- Props drilling: MisProductosPage → ListaProductos → TarjetaProducto

### CARGA DE DATOS
- MisProductosPage.vue carga productos con productosStore.cargarProductos()
- Estados de carga y error manejados por el store
- Loading spinner mientras carga
- Mensaje "No hay productos" si array vacío

### SELECCIÓN MÚLTIPLE
- Composable useSeleccionMultiple maneja estado de selección
- MisProductosPage pasa props modoSeleccion y seleccionados a ListaProductos
- ListaProductos verifica si cada producto está seleccionado con estaSeleccionado(id)
- TarjetaProducto muestra visual según estado de selección
- Set de IDs seleccionados para performance O(1)

### ELIMINACIÓN
- Eliminación múltiple con diálogo de confirmación Quasar
- Notificación con botón "Deshacer" (5 segundos timeout)
- Productos guardados en caché temporal para restaurar
- Animación fade-out al eliminar (integrada con Quasar)
- Limpieza de modo selección después de eliminar

## SISTEMA DE GRILLA RESPONSIVO (ListaProductos)
- Sistema de columnas Quasar responsive
- col-12: Móvil (1 tarjeta por fila)
- col-sm-6: Tablet pequeña (2 tarjetas por fila)
- col-md-4: Tablet/PC (3 tarjetas por fila)
- col-xl-3: PC grande (4 tarjetas por fila)
- Gutter: q-col-gutter-md (16px de separación)

## HEADER DE PÁGINA
- Título: "Mis Productos" (h5, font-weight-bold)
- Contador: Cantidad total de productos guardados
- Color texto secundario: text-grey-7
- Margin bottom: q-mb-md

## PALETA DE COLORES
- Primario: #1976D2 (azul oscuro) - precio, bordes, botones
- Secundario: #4CAF50 (verde) - ahorro, mejor precio, selección
- Acento: #FF9800 (naranja) - alertas
- Fondo app: #EEEEEE (gris medio)
- Fondo tarjeta: #FFFFFF (blanco)
- Texto primario: #1D1D1D (negro suave)
- Texto secundario: #757575 (gris)

## FEATURES IMPLEMENTADAS
- ✅ Sistema de tarjetas de productos expandibles
- ✅ Modo selección múltiple con long-press
- ✅ Código de barras copiable
- ✅ Formato de fechas relativo
- ✅ Top 3 precios ordenados
- ✅ Botón "Ver historial completo"
- ✅ Diseño responsive móvil/tablet/PC
- ✅ Animaciones suaves y feedback visual
- ✅ Vibración háptica en móvil
- ✅ Integración completa con Pinia stores
- ✅ Sistema de grilla adaptativa
- ✅ Modal agregar precio reutilizable (composable useDialogoAgregarPrecio)

## FEATURES PLANIFICADAS
- ⏳ Menú contextual (tres puntos)
- ⏳ Edición inline de productos
- ⏳ Drag & drop para reordenar
- ⏳ Filtros por comercio/precio
- ⏳ Búsqueda con autocompletado
- ⏳ Vista de cuadrícula vs lista
- ⏳ Exportar productos seleccionados
- ⏳ Compartir productos
- ⏳ Favoritos/listas personalizadas
